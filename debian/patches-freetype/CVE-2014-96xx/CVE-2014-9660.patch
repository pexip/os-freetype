Backport of:

From af8346172a7b573715134f7a51e6c5c60fa7f2ab Mon Sep 17 00:00:00 2001
From: Werner Lemberg <wl@gnu.org>
Date: Sat, 22 Nov 2014 12:29:10 +0000
Subject: [bdf] Fix Savannah bug #43660.

* src/bdf/bdflib.c (_bdf_parse_glyphs) <"ENDFONT">: Check
`_BDF_GLYPH_BITS'.
---
Index: freetype-2.4.8/src/bdf/bdflib.c
===================================================================
--- freetype-2.4.8.orig/src/bdf/bdflib.c	2015-02-24 09:57:16.323369242 -0500
+++ freetype-2.4.8/src/bdf/bdflib.c	2015-02-24 09:57:16.319369210 -0500
@@ -1520,6 +1520,14 @@
     /* Check for the ENDFONT field. */
     if ( ft_memcmp( line, "ENDFONT", 7 ) == 0 )
     {
+      if ( p->flags & _BDF_GLYPH_BITS )
+      {
+        /* Missing ENDCHAR field. */
+        FT_ERROR(( "_bdf_parse_glyphs: " ERRMSG1, lineno, "ENDCHAR" ));
+        error = BDF_Err_Corrupted_Font_Glyphs;
+        goto Exit;
+      }
+
       /* Sort the glyphs by encoding. */
       ft_qsort( (char *)font->glyphs,
                 font->glyphs_used,
